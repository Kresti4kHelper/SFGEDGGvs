<Window x:Class="Kresti4kHelper.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Kresti4kHelper"
        xmlns:conv="clr-namespace:Kresti4kHelper.Converters"
        mc:Ignorable="d"
        Title="Kresti4kHelper" Height="800" Width="1100" Background="{DynamicResource WindowBackgroundBrush}">
    <Window.Resources>
        <conv:GhostStatusToTextConverter x:Key="StatusToText" />
        <conv:StringEqualsConverter x:Key="StringEqualsConverter" />
        <conv:IndexOffsetConverter x:Key="IndexOffsetConverter" />
        <conv:CountToStarGridLengthConverter x:Key="CountToStarGridLengthConverter" />
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <Border Grid.Row="0" Background="{DynamicResource WindowBackgroundBrush}" Padding="8">
            <DockPanel>
                <TextBlock Text="Kresti4k Helper" FontWeight="Bold" FontSize="14" VerticalAlignment="Center" />
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" DockPanel.Dock="Right">
                    <TextBlock Text="Тема" VerticalAlignment="Center" Foreground="{DynamicResource SecondaryTextBrush}" />
                    <ToggleButton IsChecked="{Binding IsDarkTheme, Mode=TwoWay}"
                                  Style="{StaticResource ThemeToggleButtonStyle}"
                                  ToolTip="Переключить тему"
                                  Margin="8 0 0 0" />
                </StackPanel>
            </DockPanel>
        </Border>

        <TabControl Grid.Row="1">
            <TabItem Header="Статистика">
                <Border Background="{DynamicResource WindowBackgroundBrush}" Padding="8">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <Border Background="{DynamicResource CardBackgroundBrush}" Padding="12" CornerRadius="8" Margin="0 0 0 8" BorderBrush="{DynamicResource CardBorderBrush}" BorderThickness="1">
                            <DockPanel LastChildFill="False">
                                <StackPanel Orientation="Vertical" DockPanel.Dock="Left">
                                    <TextBlock Text="Статистика призраков" FontWeight="Bold" FontSize="16" />
                                    <TextBlock Text="{Binding IdentifiedText}" Foreground="ForestGreen" Margin="0 6 0 0" />
                                    <TextBlock Text="{Binding RejectedText}" Foreground="Firebrick" Margin="0 6 0 0" />
                                    <TextBlock Text="{Binding TopGhostText}" Margin="0 6 0 0" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" HorizontalAlignment="Right" VerticalAlignment="Center">
                                    <TextBox Width="240" Padding="10 6" Text="{Binding GhostSearchText, UpdateSourceTrigger=PropertyChanged}"
                                             VerticalContentAlignment="Center" Margin="0 0 8 0" ToolTip="Поиск по призракам" />
                                    <Button Content="Сбросить данные" Padding="12 6" Click="OnResetData" />
                                    <Button Content="Отменить" Padding="12 6" IsEnabled="{Binding CanUndo}" Click="OnUndo" Margin="8 0 0 0" />
                                </StackPanel>
                            </DockPanel>
                        </Border>

                        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                            <ItemsControl ItemsSource="{Binding GhostsView}" AlternationCount="1000"
                                          VirtualizingPanel.IsVirtualizing="True"
                                          VirtualizingPanel.VirtualizationMode="Recycling"
                                          ScrollViewer.CanContentScroll="True">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <VirtualizingStackPanel />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border BorderBrush="{DynamicResource CardBorderBrush}" BorderThickness="1" Background="{DynamicResource CardBackgroundBrush}" CornerRadius="4" Padding="10" Margin="0 0 0 8">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="2*" />
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="2*" />
                                                </Grid.ColumnDefinitions>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto" />
                                                    <RowDefinition Height="Auto" />
                                                </Grid.RowDefinitions>
                                                <StackPanel Orientation="Vertical" Grid.Column="0" Grid.RowSpan="2">
                                                    <StackPanel Orientation="Horizontal" Margin="0 0 0 4" VerticalAlignment="Center">
                                                        <Image Source="{Binding ImagePath}" Width="32" Height="32" Margin="0 0 8 0" />
                                                        <TextBlock FontWeight="Bold" FontSize="14" VerticalAlignment="Center">
                                                            <TextBlock.Text>
                                                                <MultiBinding StringFormat="{}{0}. {1} ({2})">
                                                                    <Binding RelativeSource="{RelativeSource AncestorType=ContentPresenter}" Path="(ItemsControl.AlternationIndex)" Converter="{StaticResource IndexOffsetConverter}" />
                                                                    <Binding Path="Name" />
                                                                    <Binding Path="TotalCount" />
                                                                </MultiBinding>
                                                            </TextBlock.Text>
                                                        </TextBlock>
                                                    </StackPanel>
                                                    <TextBlock Text="{Binding Status, Converter={StaticResource StatusToText}}" />
                                                    <TextBlock FontSize="12" Foreground="{DynamicResource SecondaryTextBrush}">
                                                        <TextBlock.Text>
                                                            <MultiBinding StringFormat="ОПРЕДЕЛИЛ: {0} | НЕ ОПРЕДЕЛИЛ: {1} | ВСЕГО: {2}">
                                                                <Binding Path="IdentifiedCount" />
                                                                <Binding Path="RejectedCount" />
                                                                <Binding Path="TotalCount" />
                                                            </MultiBinding>
                                                        </TextBlock.Text>
                                                    </TextBlock>
                                                </StackPanel>

                                                <Button Grid.Column="1" Content="ОПРЕДЕЛИЛ" Padding="14 10" Width="180" Height="44" Click="OnIdentifyGhost" Tag="{Binding}" Margin="12 0 0 0" />
                                                <Button Grid.Column="2" Content="НЕ ОПРЕДЕЛИЛ" Padding="14 10" Width="180" Height="44" Click="OnRejectGhost" Tag="{Binding}" Margin="12 0 0 0" />
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Grid>
                </Border>
            </TabItem>

            <TabItem Header="Расширенная статистика">
                <Border Background="{DynamicResource WindowBackgroundBrush}" Padding="8">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>
                            <Border Background="{DynamicResource CardBackgroundBrush}" Padding="12" CornerRadius="8" Margin="0 0 0 8" BorderBrush="{DynamicResource CardBorderBrush}" BorderThickness="1">
                                <DockPanel>
                                    <StackPanel>
                                        <TextBlock Text="Ключевые факты" FontSize="16" FontWeight="Bold" />
                                        <TextBlock Text="{Binding ExtendedTopGhostPercentText}" Margin="0 6 0 0" />
                                    </StackPanel>
                                    <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" HorizontalAlignment="Right">
                                        <Button Content="Отменить" Padding="12 6" Margin="0 0 8 0" IsEnabled="{Binding CanUndoExtended}" Click="OnUndoExtendedStatistics" />
                                        <Button Content="Сбросить расширенную статистику" Padding="12 6" Click="OnResetExtendedStatistics" />
                                    </StackPanel>
                                </DockPanel>
                            </Border>
                            <Border Grid.Row="1" Background="{DynamicResource CardBackgroundBrush}" Padding="12" CornerRadius="8" BorderBrush="{DynamicResource CardBorderBrush}" BorderThickness="1">
                                <StackPanel>
                                    <TextBlock Text="Диаграмма по призракам" FontWeight="Bold" FontSize="14" Margin="0 0 0 8" />
                                    <StackPanel Orientation="Horizontal" Margin="0 0 0 10">
                                        <StackPanel Orientation="Horizontal" Margin="0 0 12 0" VerticalAlignment="Center">
                                            <Rectangle Width="14" Height="14" Fill="#4caf50" RadiusX="3" RadiusY="3" />
                                            <TextBlock Text="Определил" Margin="6 0 0 0" Foreground="{DynamicResource SecondaryTextBrush}" />
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <Rectangle Width="14" Height="14" Fill="#ef5350" RadiusX="3" RadiusY="3" />
                                            <TextBlock Text="Не определил" Margin="6 0 0 0" Foreground="{DynamicResource SecondaryTextBrush}" />
                                        </StackPanel>
                                    </StackPanel>
                                    <WrapPanel Margin="0 0 0 6">
                                        <TextBlock Text="{Binding ExtendedIdentifiedText}" Foreground="{DynamicResource SecondaryTextBrush}" />
                                        <TextBlock Text="{Binding ExtendedRejectedText}" Foreground="{DynamicResource SecondaryTextBrush}" Margin="8 0 0 0" />
                                    </WrapPanel>
                                    <Border Background="{DynamicResource MutedBackgroundBrush}" BorderBrush="{DynamicResource MutedBorderBrush}" BorderThickness="1" CornerRadius="6" Margin="0 0 0 12">
                                        <Grid Height="32">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="{Binding ExtendedTotalIdentifiedCount, Converter={StaticResource CountToStarGridLengthConverter}}" />
                                                <ColumnDefinition Width="{Binding ExtendedTotalRejectedCount, Converter={StaticResource CountToStarGridLengthConverter}}" />
                                            </Grid.ColumnDefinitions>
                                            <Border Background="#4caf50" CornerRadius="6 0 0 6" />
                                            <Border Background="#ef5350" Grid.Column="1" CornerRadius="0 6 6 0" />
                                        </Grid>
                                    </Border>
                                    <ItemsControl ItemsSource="{Binding ExtendedChartGhosts}"
                                                  VirtualizingPanel.IsVirtualizing="True"
                                                  VirtualizingPanel.VirtualizationMode="Recycling"
                                                  ScrollViewer.CanContentScroll="True">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <VirtualizingStackPanel />
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Margin="0 0 0 8" Padding="8" BorderBrush="{DynamicResource SoftBorderBrush}" BorderThickness="1" CornerRadius="6">
                                                    <StackPanel>
                                                        <DockPanel>
                                                            <WrapPanel VerticalAlignment="Center">
                                                                <TextBlock Text="{Binding Name}" FontWeight="Bold" />
                                                                <TextBlock Text="{Binding IdentifiedLabel}" Margin="8 0 0 0" Foreground="{DynamicResource SecondaryTextBrush}" />
                                                                <TextBlock Text="{Binding RejectedLabel}" Margin="8 0 0 0" Foreground="{DynamicResource SecondaryTextBrush}" />
                                                            </WrapPanel>
                                                            <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" HorizontalAlignment="Right">
                                                                <TextBlock Text="{Binding TotalShareText}" Foreground="{DynamicResource SecondaryTextBrush}" Margin="0 0 8 0" />
                                                                <TextBlock Text="{Binding TotalLabel}" FontWeight="SemiBold" />
                                                            </StackPanel>
                                                        </DockPanel>
                                                        <Border Background="{DynamicResource MutedBackgroundBrush}" BorderBrush="{DynamicResource MutedBorderBrush}" BorderThickness="1" CornerRadius="4" Margin="0 6 0 0">
                                                            <Grid Height="28">
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="{Binding IdentifiedCount, Converter={StaticResource CountToStarGridLengthConverter}}" />
                                                                    <ColumnDefinition Width="{Binding RejectedCount, Converter={StaticResource CountToStarGridLengthConverter}}" />
                                                                </Grid.ColumnDefinitions>
                                                                <Border Background="#4caf50" CornerRadius="4 0 0 4" />
                                                                <Border Background="#ef5350" Grid.Column="1" CornerRadius="0 4 4 0" />
                                                                <Grid>
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="{Binding IdentifiedCount, Converter={StaticResource CountToStarGridLengthConverter}}" />
                                                                        <ColumnDefinition Width="{Binding RejectedCount, Converter={StaticResource CountToStarGridLengthConverter}}" />
                                                                    </Grid.ColumnDefinitions>
                                                                </Grid>
                                                            </Grid>
                                                        </Border>
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </ScrollViewer>
                </Border>
            </TabItem>

            <TabItem Header="Вычеркивание">
                <Border Background="{DynamicResource WindowBackgroundBrush}" Padding="8">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <Border Background="{DynamicResource CardBackgroundBrush}" BorderBrush="{DynamicResource CardBorderBrush}" BorderThickness="1" CornerRadius="8" Padding="12">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <ItemsControl ItemsSource="{Binding RemainingGhosts}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <UniformGrid Columns="3" />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <ToggleButton Content="{Binding DisplayName}" Width="240" Height="72" Margin="4"
                                                          IsChecked="{Binding IsRemoved, Mode=TwoWay}"
                                                          Checked="OnRemainingGhostToggled" Unchecked="OnRemainingGhostToggled">
                                                <ToggleButton.Style>
                                                    <Style TargetType="ToggleButton">
                                                        <Setter Property="Template">
                                                            <Setter.Value>
                                                                <ControlTemplate TargetType="ToggleButton">
                                                                    <Border x:Name="OuterBorder" BorderBrush="{DynamicResource ToggleBorderBrush}" BorderThickness="1" CornerRadius="6" Padding="8" Background="{TemplateBinding Background}">
                                                                        <Grid>
                                                                            <TextBlock x:Name="ContentText"
                                                                                       Text="{TemplateBinding Content}"
                                                                                       HorizontalAlignment="Center"
                                                                                       VerticalAlignment="Center"
                                                                                       TextWrapping="Wrap"
                                                                                       TextAlignment="Center"
                                                                                       FontWeight="SemiBold"
                                                                                       Foreground="{TemplateBinding Foreground}" />
                                                                            <Rectangle x:Name="StrikeLine" Height="1.5" Fill="{DynamicResource SecondaryTextBrush}" Stretch="Fill" Visibility="Collapsed" VerticalAlignment="Center" Margin="6 0" />
                                                                        </Grid>
                                                                    </Border>
                                                                    <ControlTemplate.Triggers>
                                                                        <Trigger Property="IsMouseOver" Value="True">
                                                                            <Setter TargetName="OuterBorder" Property="BorderBrush" Value="{DynamicResource SecondaryTextBrush}" />
                                                                        </Trigger>
                                                                        <Trigger Property="IsChecked" Value="True">
                                                                            <Setter TargetName="OuterBorder" Property="Background" Value="{DynamicResource ToggleCheckedBackgroundBrush}" />
                                                                            <Setter TargetName="ContentText" Property="Foreground" Value="{DynamicResource SecondaryTextBrush}" />
                                                                            <Setter TargetName="ContentText" Property="TextDecorations" Value="Strikethrough" />
                                                                            <Setter TargetName="StrikeLine" Property="Visibility" Value="Visible" />
                                                                        </Trigger>
                                                                    </ControlTemplate.Triggers>
                                                                </ControlTemplate>
                                                            </Setter.Value>
                                                        </Setter>
                                                        <Setter Property="Background" Value="{DynamicResource CardBackgroundBrush}" />
                                                        <Setter Property="Foreground" Value="{DynamicResource PrimaryTextBrush}" />
                                                    </Style>
                                                </ToggleButton.Style>
                                            </ToggleButton>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Border>
                        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Left" Margin="0 8 0 0">
                            <Button Content="Сбросить" Padding="12 6" Click="OnResetRemainingGhosts" />
                            <Button Content="Отменить" Padding="12 6" IsEnabled="{Binding CanUndoRemaining}" Click="OnUndoRemaining" Margin="8 0 0 0" />
                        </StackPanel>
                    </Grid>
                </Border>
            </TabItem>
            <TabItem Header="Пати">
                <Border Background="{DynamicResource WindowBackgroundBrush}" Padding="8">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <Border Background="{DynamicResource CardBackgroundBrush}" Padding="12" CornerRadius="8" BorderBrush="{DynamicResource CardBorderBrush}" BorderThickness="1" Margin="0 0 0 8">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <TextBlock Text="Пати" FontWeight="Bold" FontSize="16" VerticalAlignment="Center" Margin="0 0 8 0" />
                                <TextBox x:Name="PartyNicknameBox" Width="200" VerticalAlignment="Center" ToolTip="Ник" Margin="0 0 8 0" />
                                <TextBox x:Name="PartyInitialCountBox" Width="120" VerticalAlignment="Center" Text="0" ToolTip="Начальное число" Margin="0 0 8 0" />
                                <Button Content="Добавить" Padding="12 6" Click="OnAddPartyEntry" />
                            </StackPanel>
                        </Border>

                        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                            <ItemsControl ItemsSource="{Binding PartyEntries}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border BorderBrush="{DynamicResource CardBorderBrush}" BorderThickness="1" Background="{DynamicResource CardBackgroundBrush}" CornerRadius="8" Padding="10" Margin="0 0 0 8">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="2*" />
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>

                                                <StackPanel Orientation="Vertical" Grid.Column="0" VerticalAlignment="Center">
                                                    <TextBlock Text="{Binding Nickname}" FontWeight="Bold" FontSize="14" />
                                                </StackPanel>

                                                <TextBlock Grid.Column="1" Text="{Binding Count}" FontWeight="Bold" FontSize="16" VerticalAlignment="Center" Margin="12 0" />
                                                <Button Grid.Column="2" Content="+1" Padding="10 6" Margin="8 0 0 0" Click="OnIncrementPartyEntry" Tag="{Binding}" />
                                                <Button Grid.Column="3" Content="-1" Padding="10 6" Margin="8 0 0 0" Click="OnDecrementPartyEntry" Tag="{Binding}" />
                                                <Button Grid.Column="4" Content="Удалить" Padding="10 6" Margin="8 0 0 0" Click="OnDeletePartyEntry" Tag="{Binding}" />
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>

                        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Left" Margin="0 8 0 0">
                            <Button Content="Сбросить" Padding="12 6" Click="OnResetPartyEntries" />
                            <Button Content="Отменить" Padding="12 6" IsEnabled="{Binding CanUndoParty}" Click="OnUndoParty" Margin="8 0 0 0" />
                        </StackPanel>
                    </Grid>
                </Border>
            </TabItem>

            <TabItem Header="Выбор задания">
                <Border Background="{DynamicResource WindowBackgroundBrush}" Padding="8">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0 0 0 8">
                            <TextBlock Text="Доступные задания" FontWeight="Bold" FontSize="16" VerticalAlignment="Center" />
                            <TextBox Width="260" x:Name="TaskNameBox" VerticalAlignment="Center" ToolTip="Название задания" Margin="8 0 0 0" />
                            <Button x:Name="AddTaskButton" Content="Добавить" Padding="10 6" Click="OnAddTask" Margin="8 0 0 0" />
                            <Button x:Name="RandomTaskButton" Content="Случайно" Padding="10 6" Click="OnSelectRandomTask" Margin="8 0 0 0" />
                            <TextBox Width="220" VerticalAlignment="Center" Padding="10 6" Text="{Binding TaskSearchText, UpdateSourceTrigger=PropertyChanged}"
                                     ToolTip="Поиск по заданиям" Margin="8 0 0 0" />
                        </StackPanel>

                        <TextBlock Grid.Row="1" Text="{Binding RandomSelectionText}" Foreground="{DynamicResource SecondaryTextBrush}" Margin="0 0 0 8" />

                        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
                            <ItemsControl ItemsSource="{Binding TasksView}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border BorderBrush="{DynamicResource CardBorderBrush}" BorderThickness="1" Background="{DynamicResource CardBackgroundBrush}" CornerRadius="8" Padding="10" Margin="6" Width="200">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto" />
                                                    <RowDefinition Height="Auto" />
                                                </Grid.RowDefinitions>
                                                <TextBlock Grid.Row="0" Grid.Column="0" Text="{Binding}" FontWeight="Bold" FontSize="14" TextWrapping="Wrap" />
                                                <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                                                    <Button Content="✎" Width="24" Height="24" Click="OnEditTask" Tag="{Binding}" />
                                                    <Button Content="×" Foreground="Firebrick" Width="24" Height="24" Click="OnDeleteTask" Tag="{Binding}" Margin="4 0 0 0"/>
                                                </StackPanel>
                                                <Button Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Content="Выбрать" Padding="10 6" Margin="0 6 0 0" Click="OnSelectTask" Tag="{Binding}">
                                                    <Button.Style>
                                                        <Style TargetType="Button">
                                                            <Setter Property="Background" Value="{DynamicResource TaskButtonBackgroundBrush}" />
                                                            <Style.Triggers>
                                                                <DataTrigger Value="True">
                                                                    <DataTrigger.Binding>
                                                                        <MultiBinding Converter="{StaticResource StringEqualsConverter}">
                                                                            <Binding />
                                                                            <Binding Path="DataContext.SelectedTaskName" RelativeSource="{RelativeSource AncestorType=Window}" />
                                                                        </MultiBinding>
                                                                    </DataTrigger.Binding>
                                                                    <Setter Property="Background" Value="{DynamicResource TaskButtonSelectedBackgroundBrush}" />
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Button.Style>
                                                </Button>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Grid>
                </Border>
            </TabItem>
        </TabControl>
        <Border Grid.Row="2" Background="{DynamicResource WindowBackgroundBrush}" Padding="8 4">
            <TextBlock HorizontalAlignment="Center" Foreground="{DynamicResource FooterTextBrush}" FontSize="12" Text="{Binding AppVersion}" />
        </Border>
    </Grid>
</Window>